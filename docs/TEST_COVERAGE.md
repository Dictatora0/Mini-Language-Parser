# Mini 语言语法分析器测试覆盖报告

## 测试概述

本文档详细说明了 Mini 语言语法分析器的测试覆盖情况，包含所有要求的测试用例类型。

## 测试文件

### 主要测试文件

1. **tests/test_parser_comprehensive.py** - 综合测试套件
   - 包含 6 大类测试，共 57 个测试用例
   - 覆盖所有语法分析功能
   - 包含正确程序和错误程序的测试

2. **tests/test_cases.py** - 详细测试用例集
   - 包含更详细的测试用例
   - 按功能分类组织
   - 包含边界情况测试

3. **test_improvements.py** - 改进功能测试
   - 测试增强的词法分析器
   - 测试变量声明
   - 测试 AST 生成
   - 测试语义分析
   - 测试解释器执行

### 测试数据文件

位于 `data/` 目录下：

- `test_assignment.txt` - 赋值语句测试
- `test_assignment_error.txt` - 赋值语句错误测试
- `test_if_then.txt` - if-then 结构测试
- `test_if_error.txt` - if-then 错误测试
- `test_while.txt` - while 循环测试
- `test_while_error.txt` - while 循环错误测试
- `test_block.txt` - 块结构测试
- `test_block_error.txt` - 块结构错误测试
- `test_expression.txt` - 表达式测试
- `test_expression_error.txt` - 表达式错误测试

## 测试类别详解

### 1. 赋值语句测试（8 个测试用例）

**目的**：验证语法分析器对赋值语句的识别能力，包括左标识符与右表达式的正确匹配和结构构建。

#### 正确程序测试（5 个）

1. **简单整数赋值**
   ```
   x := 5
   ```
   - 测试基本赋值语句

2. **算术表达式赋值**
   ```
   x := 5 + 3 * (2 - 1)
   ```
   - 测试赋值语句中的算术表达式
   - 验证运算符优先级

3. **复杂表达式赋值**
   ```
   result := (a + b) * c - d / e
   ```
   - 测试复杂的算术表达式
   - 验证括号和多个运算符

4. **多个赋值语句**
   ```
   x := 10;
   y := 20;
   z := x + y
   ```
   - 测试连续的赋值语句
   - 验证分号分隔

5. **负数赋值**
   ```
   x := -5;
   y := -(a + b)
   ```
   - 测试负数和负号运算符

#### 错误程序测试（3 个）

1. **缺少赋值运算符**
   ```
   x = 10  // 错误：应该是 :=
   ```
   - 验证能检测到使用 = 而不是 :=

2. **赋值运算符后缺少表达式**
   ```
   x :=   // 错误：缺少右侧表达式
   ```
   - 验证能检测到不完整的赋值语句

3. **不完整的算术表达式**
   ```
   x := 10 +   // 错误：运算符后缺少操作数
   ```
   - 验证能检测到表达式不完整

### 2. if-then 结构测试（8 个测试用例）

**目的**：测试语法分析器对 if-then 和 if-then-else 控制结构的识别与语法树构建是否正确，运算符参与条件表达式的计算是否有效。

#### 正确程序测试（6 个）

1. **简单 if-then**
   ```
   if x >= 0 then
       x := x - 1
   ```
   - 测试基本的 if-then 结构
   - 验证关系运算符 >=

2. **if-then-else**
   ```
   if x > 0 then
       y := 1
   else
       y := 0
   ```
   - 测试 if-then-else 结构
   - 验证 else 分支

3. **if 条件中的算术表达式**
   ```
   if x + y > 10 then
       z := x * y
   ```
   - 测试条件中包含算术表达式
   - 验证表达式求值

4. **if 条件中的逻辑运算**
   ```
   if (x > 0) and (y < 10) then
       z := 1
   ```
   - 测试逻辑运算符 and
   - 验证复合条件

5. **嵌套 if-then**
   ```
   if x > 0 then
       if y > 0 then
           z := x + y
   ```
   - 测试 if 语句嵌套
   - 验证嵌套结构的正确性

6. **if-then 带语句块**
   ```
   if x > 0 then
   begin
       y := x;
       z := x * 2
   end
   ```
   - 测试 if 语句带 begin-end 块
   - 验证块中的多条语句

#### 错误程序测试（2 个）

1. **缺少 then 关键字**
   ```
   if x
       y := 1  // 错误：缺少 then
   ```
   - 验证能检测到缺少 then 关键字

2. **if 条件缺少关系运算符**
   ```
   if x then  // 错误：条件不完整
       y := 1
   ```
   - 验证能检测到条件表达式错误

### 3. while 循环结构测试（7 个测试用例）

**目的**：验证 while 循环结构的语法分析正确性，以及循环体中标识符的识别与错误处理。

#### 正确程序测试（5 个）

1. **简单 while 循环**
   ```
   sum := 0;
   i := 1;
   while i <= 5 do
       i := i + 1
   ```
   - 测试基本的 while 循环
   - 验证循环条件和循环体

2. **while 带语句块**
   ```
   while i <= 5 do
   begin
       sum := sum + i;
       i := i + 1
   end
   ```
   - 测试 while 循环带 begin-end 块
   - 验证块中的多条语句

3. **while 条件中的逻辑运算**
   ```
   while (i < 10) and (sum < 100) do
       i := i + 1
   ```
   - 测试循环条件中的逻辑运算
   - 验证复合条件

4. **嵌套 while 循环**
   ```
   while i < 5 do
   begin
       j := 0;
       while j < 5 do
           j := j + 1;
       i := i + 1
   end
   ```
   - 测试 while 循环嵌套
   - 验证嵌套结构的正确性

5. **while 中嵌套 if**
   ```
   while i < 10 do
   begin
       if i > 5 then
           sum := sum + i;
       i := i + 1
   end
   ```
   - 测试 while 和 if 的混合嵌套
   - 验证控制流的正确性

#### 错误程序测试（2 个）

1. **缺少 do 关键字**
   ```
   while x > 0
       x := x - 1  // 错误：缺少 do
   ```
   - 验证能检测到缺少 do 关键字

2. **while 条件缺少关系运算符**
   ```
   while i do  // 错误：条件不完整
       i := i + 1
   ```
   - 验证能检测到条件表达式错误

### 4. 块结构测试（8 个测试用例）

**目的**：验证语法分析器是否能正确处理代码块（Block）。

#### 正确程序测试（6 个）

1. **简单块**
   ```
   begin
       begin
           x := 5
       end
   end
   ```
   - 测试基本的块结构
   - 验证 begin-end 匹配

2. **块包含多条语句**
   ```
   begin
       x := 1;
       y := 2;
       z := x + y
   end
   ```
   - 测试块中的多条语句
   - 验证语句分隔

3. **嵌套块**
   ```
   begin
       x := 1;
       begin
           y := 2;
           begin
               z := 3
           end
       end
   end
   ```
   - 测试块的嵌套
   - 验证多层嵌套的正确性

4. **空块**
   ```
   begin
       begin
       end
   end
   ```
   - 测试空的代码块
   - 验证边界情况

5. **if-then 带块**
   ```
   if x > 0 then
   begin
       y := x;
       z := x * 2
   end
   ```
   - 测试 if 语句中的块
   - 验证控制结构与块的结合

6. **while 带块**
   ```
   while i < 10 do
   begin
       sum := sum + i;
       i := i + 1
   end
   ```
   - 测试 while 循环中的块
   - 验证循环体块的正确性

#### 错误程序测试（2 个）

1. **缺少 end 关键字**
   ```
   begin
       begin
           x := 1  // 错误：缺少 end
   end
   ```
   - 验证能检测到缺少 end 关键字

2. **begin-end 不匹配**
   ```
   begin
       begin
           begin
               x := 1
           end  // 错误：缺少一个 end
   end
   ```
   - 验证能检测到 begin-end 不匹配

### 5. 不同级别的表达式测试（13 个测试用例）

**目的**：测试语法分析器对表达式中运算符优先级与结合性处理的正确性。

#### 正确程序测试（9 个）

1. **简单算术表达式**
   ```
   result := 2 + 3 * 4 - 5 / 2
   ```
   - 测试四则运算
   - 验证运算符优先级（* / 优先于 + -）

2. **运算符优先级**
   ```
   result := a + b * c / d - e
   ```
   - 测试混合运算符
   - 验证优先级规则

3. **括号改变优先级**
   ```
   result := (a + b) * (c - d)
   ```
   - 测试括号的作用
   - 验证括号改变运算顺序

4. **嵌套括号**
   ```
   result := ((a + b) * c) / (d - (e + f))
   ```
   - 测试多层括号嵌套
   - 验证括号匹配

5. **负数表达式**
   ```
   x := -5;
   y := -(a + b);
   z := -x * -y
   ```
   - 测试负号运算符
   - 验证一元运算符

6. **关系表达式**
   ```
   if a + b > c * d then
       x := 1
   ```
   - 测试关系运算符
   - 验证关系表达式中的算术运算

7. **逻辑表达式**
   ```
   if (x > 0) and (y < 10) or (z = 5) then
       result := 1
   ```
   - 测试逻辑运算符 and、or
   - 验证逻辑运算符优先级

8. **not 运算符**
   ```
   if not (x < 0) then
       y := 1
   ```
   - 测试逻辑非运算符
   - 验证 not 的作用

9. **复杂混合表达式**
   ```
   if ((a + b) * c > d) and (not (e = f)) then
       result := (x + y) / (z - w)
   ```
   - 测试算术、关系、逻辑运算符的混合
   - 验证复杂表达式的正确解析

#### 错误程序测试（4 个）

1. **表达式不完整 - 加法**
   ```
   result := 1 +   // 错误：缺少右操作数
   ```
   - 验证能检测到不完整的加法表达式

2. **表达式不完整 - 乘法**
   ```
   result := a *   // 错误：缺少右操作数
   ```
   - 验证能检测到不完整的乘法表达式

3. **括号不匹配**
   ```
   result := (a + b  // 错误：缺少右括号
   ```
   - 验证能检测到括号不匹配

4. **缺少操作数**
   ```
   result := + 5  // 错误：缺少左操作数
   ```
   - 验证能检测到缺少操作数

### 6. 错误处理测试（13 个测试用例）

**目的**：验证语法分析器在遇到语法错误时，能否确保错误被正确识别并输出。

#### 程序结构错误（6 个）

1. **缺少 program 关键字**
   - 验证程序必须以 program 开头

2. **缺少程序名**
   - 验证 program 后必须有标识符

3. **缺少分号**
   - 验证程序名后必须有分号

4. **缺少 begin**
   - 验证程序体必须以 begin 开始

5. **缺少 end**
   - 验证程序体必须以 end 结束

6. **缺少结束点**
   - 验证程序必须以 . 结尾

#### 语句错误（4 个）

7. **赋值运算符错误**
   - 验证必须使用 := 而不是 =

8. **if 缺少 then**
   - 验证 if 语句必须有 then

9. **while 缺少 do**
   - 验证 while 语句必须有 do

10. **条件表达式错误**
    - 验证条件必须包含关系运算符

#### 表达式错误（3 个）

11. **表达式不完整**
    - 验证表达式必须完整

12. **括号不匹配**
    - 验证括号必须成对出现

13. **begin-end 不匹配**
    - 验证 begin 和 end 必须匹配

## 测试统计

### 综合测试套件统计

- **总测试用例数**：57 个
- **通过率**：100%
- **测试类别**：6 大类
  1. 赋值语句测试：8 个用例
  2. if-then 结构测试：8 个用例
  3. while 循环结构测试：7 个用例
  4. 块结构测试：8 个用例
  5. 表达式测试：13 个用例
  6. 错误处理测试：13 个用例

### 测试覆盖的语法规则

- ✅ 程序结构（program ... begin ... end.）
- ✅ 赋值语句（:=）
- ✅ if-then 语句
- ✅ if-then-else 语句
- ✅ while-do 语句
- ✅ begin-end 块
- ✅ 算术表达式（+、-、*、/）
- ✅ 关系表达式（<、<=、>、>=、=、<>）
- ✅ 逻辑表达式（and、or、not）
- ✅ 括号表达式
- ✅ 负号运算符
- ✅ 嵌套结构
- ✅ 错误检测和报告

## 运行测试

### 运行综合测试套件

```bash
python tests/test_parser_comprehensive.py
```

### 运行详细测试用例

```bash
python tests/test_cases.py
```

### 运行改进功能测试

```bash
python test_improvements.py
```

## 测试结果示例

```
================================================================================
  Mini 语言语法分析器 - 综合测试套件
================================================================================

================================================================================
【测试 1】赋值语句测试
验证语法分析器对赋值语句的识别能力
================================================================================

测试: 简单整数赋值
  ✅ 通过

测试: 算术表达式赋值
  ✅ 通过

...

================================================================================
测试总结: 57/57 通过
================================================================================
```

## 结论

本测试套件全面覆盖了 Mini 语言语法分析器的所有功能，包括：

1. ✅ **赋值语句测试** - 完整覆盖各种赋值场景和错误情况
2. ✅ **if-then 结构测试** - 覆盖条件语句的各种形式
3. ✅ **while 循环测试** - 覆盖循环结构和嵌套情况
4. ✅ **块结构测试** - 覆盖代码块的各种组合
5. ✅ **表达式测试** - 覆盖运算符优先级和结合性
6. ✅ **错误处理测试** - 覆盖各种语法错误的检测

所有测试用例均通过，证明语法分析器能够正确识别合法程序并准确检测语法错误。
